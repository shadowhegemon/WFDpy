<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}WFD Logger{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/dark-mode.css') }}" rel="stylesheet">
    {% block extra_css %}{% endblock %}
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('home') }}">WFD Logger</a>
            
            <!-- Mobile menu toggle -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <div class="navbar-nav me-auto">
                    <a class="nav-link {% if request.endpoint == 'home' %}active{% endif %}" href="{{ url_for('home') }}">Home</a>
                    <a class="nav-link {% if request.endpoint == 'log_contact' %}active{% endif %}" href="{{ url_for('log_contact') }}">Log Contact</a>
                    <a class="nav-link {% if request.endpoint == 'contacts' %}active{% endif %}" href="{{ url_for('contacts') }}">View Contacts</a>
                    <a class="nav-link {% if request.endpoint == 'stats' %}active{% endif %}" href="{{ url_for('stats') }}">Statistics</a>
                    <a class="nav-link {% if request.endpoint == 'map_view' %}active{% endif %}" href="{{ url_for('map_view') }}">Map</a>
                    <a class="nav-link {% if request.endpoint in ['station_setup', 'new_station_setup', 'edit_station_setup'] %}active{% endif %}" href="{{ url_for('station_setup') }}">Station Setup</a>
                    <a class="nav-link {% if request.endpoint == 'duplicate_settings' %}active{% endif %}" href="{{ url_for('duplicate_settings') }}">
                        <i class="bi bi-shield-check"></i> Duplicate Settings
                    </a>
                    <a class="nav-link {% if request.endpoint == 'objectives' %}active{% endif %}" href="{{ url_for('objectives') }}">Objectives</a>
                    <a class="nav-link {% if request.endpoint == 'wfd_rules' %}active{% endif %}" href="{{ url_for('wfd_rules') }}">WFD Rules</a>
                </div>
                
                <!-- Real-time clock and Dark mode toggle -->
                <div class="navbar-nav d-flex align-items-center">
                    <!-- Real-time clock -->
                    <div class="navbar-text me-3" id="clock-display">
                        <div class="d-flex flex-column text-end">
                            <small class="text-light opacity-75" style="font-size: 0.7rem; line-height: 1;">GMT</small>
                            <span class="fw-bold" style="font-size: 0.9rem; line-height: 1;" id="gmt-time">--:--:--</span>
                            <small class="text-light opacity-75" style="font-size: 0.7rem; line-height: 1;" id="local-label">Local</small>
                            <span class="fw-bold" style="font-size: 0.9rem; line-height: 1;" id="local-time">--:--:--</span>
                        </div>
                    </div>
                    
                    <!-- Keyboard shortcuts help button -->
                    <button class="btn btn-outline-light btn-sm me-2" type="button" onclick="wfdShortcuts?.showHelp()" title="Keyboard Shortcuts (F1)">
                        <i class="bi bi-keyboard"></i>
                    </button>
                    
                    <!-- Sticky navigation toggle -->
                    <button class="btn btn-outline-light btn-sm me-2" type="button" id="sticky-nav-toggle" title="Toggle Sticky Navigation">
                        <i class="bi bi-pin-angle" id="sticky-nav-icon"></i>
                    </button>
                    
                    <!-- Theme selector dropdown -->
                    <div class="dropdown">
                        <button class="btn dark-mode-toggle navbar-text dropdown-toggle" type="button" id="themeDropdown" data-bs-toggle="dropdown" aria-expanded="false" title="Select theme">
                            <i class="bi bi-palette theme-icon" id="theme-icon"></i>
                            <span id="theme-text">Light</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="themeDropdown">
                            <li><h6 class="dropdown-header">Basic Themes</h6></li>
                            <li><a class="dropdown-item" href="#" data-theme="light"><i class="bi bi-sun"></i> Light</a></li>
                            <li><a class="dropdown-item" href="#" data-theme="dark"><i class="bi bi-moon"></i> Dark</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><h6 class="dropdown-header">School Colors</h6></li>
                            <li><a class="dropdown-item" href="#" data-theme="auburn-light"><i class="bi bi-sun" style="color: #DD550C;"></i> Auburn Tigers (Light)</a></li>
                            <li><a class="dropdown-item" href="#" data-theme="auburn"><i class="bi bi-moon" style="color: #DD550C;"></i> Auburn Tigers (Dark)</a></li>
                            <li><a class="dropdown-item" href="#" data-theme="alabama-light"><i class="bi bi-sun text-danger"></i> Alabama Crimson Tide (Light)</a></li>
                            <li><a class="dropdown-item" href="#" data-theme="alabama"><i class="bi bi-moon text-danger"></i> Alabama Crimson Tide (Dark)</a></li>
                            <li><a class="dropdown-item" href="#" data-theme="georgia-light"><i class="bi bi-sun text-danger"></i> Georgia Bulldogs (Light)</a></li>
                            <li><a class="dropdown-item" href="#" data-theme="georgia"><i class="bi bi-moon text-danger"></i> Georgia Bulldogs (Dark)</a></li>
                            <li><a class="dropdown-item" href="#" data-theme="lsu-light"><i class="bi bi-sun" style="color: #461D7C;"></i> LSU Tigers (Light)</a></li>
                            <li><a class="dropdown-item" href="#" data-theme="lsu"><i class="bi bi-moon" style="color: #461D7C;"></i> LSU Tigers (Dark)</a></li>
                            <li><a class="dropdown-item" href="#" data-theme="florida-light"><i class="bi bi-sun text-primary"></i> Florida Gators (Light)</a></li>
                            <li><a class="dropdown-item" href="#" data-theme="florida"><i class="bi bi-moon text-primary"></i> Florida Gators (Dark)</a></li>
                            <li><a class="dropdown-item" href="#" data-theme="tennessee-light"><i class="bi bi-sun" style="color: #FF8200;"></i> Tennessee Volunteers (Light)</a></li>
                            <li><a class="dropdown-item" href="#" data-theme="tennessee"><i class="bi bi-moon" style="color: #FF8200;"></i> Tennessee Volunteers (Dark)</a></li>
                            <li><a class="dropdown-item" href="#" data-theme="tamu-light"><i class="bi bi-sun" style="color: #500000;"></i> Texas A&M Aggies (Light)</a></li>
                            <li><a class="dropdown-item" href="#" data-theme="tamu"><i class="bi bi-moon" style="color: #500000;"></i> Texas A&M Aggies (Dark)</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><h6 class="dropdown-header">Military</h6></li>
                            <li><a class="dropdown-item" href="#" data-theme="army-light"><i class="bi bi-sun" style="color: #4B5320;"></i> Army (Light)</a></li>
                            <li><a class="dropdown-item" href="#" data-theme="army"><i class="bi bi-moon" style="color: #4B5320;"></i> Army (Dark)</a></li>
                            <li><a class="dropdown-item" href="#" data-theme="navy-light"><i class="bi bi-sun" style="color: #000080;"></i> Navy (Light)</a></li>
                            <li><a class="dropdown-item" href="#" data-theme="navy"><i class="bi bi-moon" style="color: #000080;"></i> Navy (Dark)</a></li>
                            <li><a class="dropdown-item" href="#" data-theme="airforce-light"><i class="bi bi-sun" style="color: #004F98;"></i> Air Force (Light)</a></li>
                            <li><a class="dropdown-item" href="#" data-theme="airforce"><i class="bi bi-moon" style="color: #004F98;"></i> Air Force (Dark)</a></li>
                            <li><a class="dropdown-item" href="#" data-theme="marines-light"><i class="bi bi-sun text-danger"></i> Marines (Light)</a></li>
                            <li><a class="dropdown-item" href="#" data-theme="marines"><i class="bi bi-moon text-danger"></i> Marines (Dark)</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><h6 class="dropdown-header">Seasonal</h6></li>
                            <li><a class="dropdown-item" href="#" data-theme="winter-light"><i class="bi bi-sun" style="color: #4A90E2;"></i> Snow/Winter (Light)</a></li>
                            <li><a class="dropdown-item" href="#" data-theme="winter-dark"><i class="bi bi-moon" style="color: #87CEEB;"></i> Snow/Winter (Dark)</a></li>
                            <li><a class="dropdown-item" href="#" data-theme="patriotic-light"><i class="bi bi-sun text-primary"></i> USA Patriotic (Light)</a></li>
                            <li><a class="dropdown-item" href="#" data-theme="patriotic"><i class="bi bi-moon text-primary"></i> USA Patriotic (Dark)</a></li>
                            <li><a class="dropdown-item" href="#" data-theme="neon-light"><i class="bi bi-sun" style="color: #FF00FF;"></i> Neon/Cyberpunk (Light)</a></li>
                            <li><a class="dropdown-item" href="#" data-theme="neon"><i class="bi bi-moon" style="color: #00FFFF;"></i> Neon/Cyberpunk (Dark)</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    {% block content %}{% endblock %}

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Keyboard Shortcuts System -->
    <script src="{{ url_for('static', filename='js/keyboard-shortcuts.js') }}"></script>
    
    <!-- Theme Switching JavaScript -->
    <script>
        // Theme functionality
        const themeIcon = document.getElementById('theme-icon');
        const themeText = document.getElementById('theme-text');
        const htmlElement = document.documentElement;
        
        // Theme name mappings for display
        const themeNames = {
            'light': 'Light',
            'dark': 'Dark',
            'auburn-light': 'Auburn (Light)',
            'auburn': 'Auburn (Dark)',
            'alabama-light': 'Alabama (Light)',
            'alabama': 'Alabama (Dark)',
            'georgia-light': 'Georgia (Light)',
            'georgia': 'Georgia (Dark)',
            'lsu-light': 'LSU (Light)',
            'lsu': 'LSU (Dark)',
            'florida-light': 'Florida (Light)',
            'florida': 'Florida (Dark)',
            'tennessee-light': 'Tennessee (Light)',
            'tennessee': 'Tennessee (Dark)',
            'tamu-light': 'Texas A&M (Light)',
            'tamu': 'Texas A&M (Dark)',
            'army-light': 'Army (Light)',
            'army': 'Army (Dark)',
            'navy-light': 'Navy (Light)',
            'navy': 'Navy (Dark)',
            'airforce-light': 'Air Force (Light)',
            'airforce': 'Air Force (Dark)',
            'marines-light': 'Marines (Light)',
            'marines': 'Marines (Dark)',
            'winter-light': 'Winter (Light)',
            'winter-dark': 'Winter (Dark)',
            'patriotic-light': 'Patriotic (Light)',
            'patriotic': 'Patriotic (Dark)',
            'neon-light': 'Neon (Light)',
            'neon': 'Neon (Dark)'
        };
        
        // Check for saved theme preference or default to light mode
        const currentTheme = localStorage.getItem('theme') || 'light';
        
        // Apply the saved theme on page load
        function applyTheme(theme) {
            if (theme === 'light') {
                htmlElement.removeAttribute('data-bs-theme');
                themeIcon.className = 'bi bi-sun theme-icon';
            } else {
                htmlElement.setAttribute('data-bs-theme', theme);
                // Use appropriate icon based on theme type
                if (theme.includes('-light') || theme === 'light') {
                    themeIcon.className = 'bi bi-sun theme-icon';
                } else {
                    themeIcon.className = 'bi bi-moon theme-icon';
                }
            }
            
            // Update button text
            themeText.textContent = themeNames[theme] || 'Custom Theme';
        }
        
        // Apply theme on page load
        applyTheme(currentTheme);
        
        // Handle theme selection from dropdown
        document.addEventListener('DOMContentLoaded', function() {
            const themeItems = document.querySelectorAll('.dropdown-item[data-theme]');
            
            themeItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const selectedTheme = this.getAttribute('data-theme');
                    
                    applyTheme(selectedTheme);
                    localStorage.setItem('theme', selectedTheme);
                });
            });
        });
        
        // Watch for system theme changes (optional enhancement)
        if (window.matchMedia) {
            const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
            
            // Only auto-apply system theme if user hasn't manually set a preference
            if (!localStorage.getItem('theme')) {
                applyTheme(mediaQuery.matches ? 'dark' : 'light');
            }
            
            mediaQuery.addEventListener('change', function(e) {
                // Only auto-apply if user hasn't set a manual preference
                if (!localStorage.getItem('theme')) {
                    applyTheme(e.matches ? 'dark' : 'light');
                }
            });
        }
    </script>
    
    <!-- Real-time Clock JavaScript -->
    <script>
        let stationTimezone = 'America/New_York';
        let stationLabel = 'Eastern';
        
        // Fetch station timezone information
        async function fetchStationTimezone() {
            try {
                const response = await fetch('/api/station_timezone');
                if (response.ok) {
                    const data = await response.json();
                    stationTimezone = data.timezone;
                    stationLabel = data.label;
                    
                    // Update the local time label
                    document.getElementById('local-label').textContent = stationLabel;
                }
            } catch (error) {
                console.warn('Failed to fetch station timezone:', error);
            }
        }
        
        function updateNavClock() {
            const now = new Date();
            
            // GMT time
            const gmtOptions = {
                timeZone: 'UTC',
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            };
            const gmtTime = now.toLocaleTimeString('en-US', gmtOptions);
            document.getElementById('gmt-time').textContent = gmtTime;
            
            // Local time based on station timezone
            const localOptions = {
                timeZone: stationTimezone,
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            };
            const localTime = now.toLocaleTimeString('en-US', localOptions);
            document.getElementById('local-time').textContent = localTime;
        }
        
        // Initialize clock
        document.addEventListener('DOMContentLoaded', function() {
            fetchStationTimezone().then(() => {
                updateNavClock();
                // Update clock every second
                setInterval(updateNavClock, 1000);
            });
        });
    </script>
    
    <!-- Sticky Navigation JavaScript -->
    <script>
        // Sticky navigation functionality
        const stickyNavToggle = document.getElementById('sticky-nav-toggle');
        const stickyNavIcon = document.getElementById('sticky-nav-icon');
        const navbar = document.querySelector('.navbar');
        const body = document.body;
        
        // Check for saved sticky nav preference
        const stickyNavEnabled = localStorage.getItem('stickyNav') === 'true';
        
        // Apply sticky nav state on page load
        function applyStickyNav(enabled) {
            if (enabled) {
                navbar.classList.add('navbar-sticky');
                body.classList.add('sticky-nav-enabled');
                stickyNavToggle.classList.add('active');
                stickyNavToggle.title = 'Disable Sticky Navigation';
            } else {
                navbar.classList.remove('navbar-sticky');
                body.classList.remove('sticky-nav-enabled');
                stickyNavToggle.classList.remove('active');
                stickyNavToggle.title = 'Enable Sticky Navigation';
            }
        }
        
        // Apply saved state on page load
        applyStickyNav(stickyNavEnabled);
        
        // Handle sticky nav toggle click
        stickyNavToggle.addEventListener('click', function(e) {
            e.preventDefault();
            const isCurrentlyEnabled = navbar.classList.contains('navbar-sticky');
            const newState = !isCurrentlyEnabled;
            
            applyStickyNav(newState);
            localStorage.setItem('stickyNav', newState.toString());
        });
        
        // Update sticky nav state when scrolling (optional enhancement)
        let lastScrollTop = 0;
        window.addEventListener('scroll', function() {
            if (!navbar.classList.contains('navbar-sticky')) return;
            
            const currentScrollTop = window.pageYOffset || document.documentElement.scrollTop;
            
            // Optional: Auto-hide on scroll down, show on scroll up
            // if (currentScrollTop > lastScrollTop && currentScrollTop > 100) {
            //     navbar.style.transform = 'translateY(-100%)';
            // } else {
            //     navbar.style.transform = 'translateY(0)';
            // }
            
            lastScrollTop = currentScrollTop <= 0 ? 0 : currentScrollTop;
        });
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>